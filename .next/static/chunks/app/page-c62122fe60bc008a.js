(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5705:function(e,t,a){Promise.resolve().then(a.bind(a,5473))},5473:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var r=a(7437),i=a(7161),s=a(2319),n=a(6400),o=a(1183),l=a(9292),c=a(373),d=a(6),u=a(8559),h=a(4589),m=a(8022),p=a(2940),f=a(1019),g=a(7717),y=a(2265),x=a(5095),v=a(8320),w=a(4764);class b{async sendMessage(e){if(!e.length)throw Error("At least one message is required");if(!this.apiKey||"your_deepseek_api_key_here"===this.apiKey)throw Error("Invalid or missing DeepSeek API key. Please set a valid API key in your .env.local file.");try{var t,a,r,i;let s=await fetch("https://api.deepseek.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"deepseek-chat",messages:e.map(e=>({role:e.isUser?"user":"assistant",content:e.content})),stream:!1})});if(!s.ok){let e=await s.text(),t="API request failed with status ".concat(s.status);try{let a=JSON.parse(e);t=(null===(i=a.error)||void 0===i?void 0:i.message)||t}catch(a){t+=": ".concat(e)}throw Error(t)}let n=await s.json();if(!(null===(r=n.choices)||void 0===r?void 0:null===(a=r[0])||void 0===a?void 0:null===(t=a.message)||void 0===t?void 0:t.content))throw Error("Invalid response format from DeepSeek API");return n.choices[0].message.content}catch(e){throw console.error("Error calling DeepSeek API:",e),e instanceof Error?e:Error("Unknown error occurred")}}async analyzeImage(e){if(!e)throw Error("Image file is required");if(!e.type.startsWith("image/"))throw Error("Invalid file type. Only images are supported.");return"Image analysis will be implemented in future versions."}constructor(e){if(!e)throw Error("DeepSeek API key is required");this.apiKey=e}}let k=new w.gm({url:"https://free-collie-81828-us1.upstash.io",token:"ABUFMGZyZWUtY29sbGllLTgxODI4LXVzMWFkbWluWVRJMFpEa3dOall0TW1GbU9TMDBOV0V4TFdJeE16Y3RPRGsxWW1VM1l6TTRPVEF3"});class I extends b{async searchSimilarDocs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return await k.query({data:e,topK:t,includeMetadata:!0,includeData:!0})}async sendMessage(e){let t=e[e.length-1],a=(await this.searchSimilarDocs(t.content)).map(e=>e.data).join("\n"),r=[...e];return r[r.length-1]={...t,content:"Context: ".concat(a,"\n\nUser Question: ").concat(t.content)},super.sendMessage(r)}async analyzeImage(e){let t=await super.analyzeImage(e),a=(await this.searchSimilarDocs(t)).map(e=>e.data).join("\n");return"Based on similar items in our database:\n".concat(a,"\n\nAnalysis: ").concat(t)}constructor(e){super(e)}}function U(){let[e,t]=(0,y.useState)([]),[a,w]=(0,y.useState)(""),[b,k]=(0,y.useState)(!1),U=(0,y.useRef)(null),j=(0,y.useRef)(null),E=(0,i.ff)("white","gray.800"),D=(0,i.ff)("blue.500","blue.200"),S=(0,i.ff)("gray.100","gray.700"),A=(0,s.p)(),M=new I("sk-110532fba43d40f08e59e8b05565169d");(0,y.useEffect)(()=>{C()},[e]);let C=()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},P=async()=>{if(!a.trim()||b)return;k(!0);let r={id:crypto.randomUUID(),content:a,isUser:!0,timestamp:new Date};t(e=>[...e,r]),w("");try{let a=await M.sendMessage([...e,r]),i={id:crypto.randomUUID(),content:a,isUser:!1,timestamp:new Date};t(e=>[...e,i])}catch(e){A({title:"Error",description:e instanceof Error?e.message:"Failed to get response from AI",status:"error",duration:5e3,isClosable:!0})}finally{k(!1)}},W=async e=>{var a;let r=null===(a=e.target.files)||void 0===a?void 0:a[0];if(r&&!b){k(!0);try{let e=await M.analyzeImage(r),a={id:crypto.randomUUID(),content:e,isUser:!1,timestamp:new Date};t(e=>[...e,a])}catch(e){A({title:"Error",description:"Failed to analyze image",status:"error",duration:3e3,isClosable:!0})}finally{k(!1),e.target&&(e.target.value="")}}};return(0,r.jsx)(n.W,{maxW:"container.md",p:4,children:(0,r.jsxs)(o.x,{bg:E,borderRadius:"lg",boxShadow:"lg",p:4,height:"70vh",display:"flex",flexDirection:"column",role:"region","aria-label":"Chat messages",children:[(0,r.jsxs)(l.g,{flex:1,overflowY:"auto",spacing:4,mb:4,alignItems:"stretch",children:[(0,r.jsx)(x.M,{children:e.map(e=>(0,r.jsx)(v.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{width:"100%"},children:(0,r.jsxs)(o.x,{alignSelf:e.isUser?"flex-end":"flex-start",bg:e.isUser?D:S,color:e.isUser?"white":"inherit",borderRadius:"lg",px:4,py:2,maxW:"70%",as:v.E.div,whileHover:{scale:1.02},role:"article","aria-label":"".concat(e.isUser?"Your":"Assistant"," message"),children:[(0,r.jsx)(c.x,{children:e.content}),(0,r.jsx)(c.x,{fontSize:"xs",color:e.isUser?"whiteAlpha.700":"gray.500",mt:1,children:e.timestamp.toLocaleTimeString()})]})},e.id))}),(0,r.jsx)("div",{ref:j})]}),(0,r.jsxs)(d.U,{spacing:2,as:"form",onSubmit:e=>{e.preventDefault(),P()},children:[(0,r.jsx)("input",{type:"file",ref:U,onChange:W,accept:"image/*",style:{display:"none"},"aria-label":"Upload image"}),(0,r.jsx)(u.h,{"aria-label":"Upload image",icon:(0,r.jsx)(f.U,{}),onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.click()},isDisabled:b}),(0,r.jsx)(h.I,{placeholder:"Ask about eco-friendly coupons...",value:a,onChange:e=>w(e.target.value),"aria-label":"Message input",isDisabled:b}),(0,r.jsx)(m.z,{colorScheme:"blue",rightIcon:b?(0,r.jsx)(p.$,{size:"sm"}):(0,r.jsx)(g.m,{}),onClick:P,isDisabled:b||!a.trim(),type:"submit",children:"Send"})]})]})})}function j(){return(0,r.jsx)("main",{children:(0,r.jsx)(U,{})})}}},function(e){e.O(0,[302,935,971,117,744],function(){return e(e.s=5705)}),_N_E=e.O()}]);